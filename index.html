<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script type="text/javascript" src="model.js"></script>
<script type="text/javascript" src="core.js"></script>
<script type="text/javascript" src="commands.js"></script>
<script type="text/javascript">

function run() {
    try{
		document.getElementById("start").style.display = "none";
		init();
		var timer = null;
		var loop = function() {
			if(done){
				clearInterval(timer);
				document.getElementById("start").style.display = "inline-block";
			}
			else {
				var bodyId = "player";
				var body = everyone[bodyId];
				if(body.inputQ.length > 0){
					if(body.hp > 0){
						displayln(bodyId);
						body.doCommand();
					}
					else{ 
						displayln("Knocked out!"); 
					}
				}
			}
		};
		timer = setInterval(loop, 100);
    }
    catch(exp){
        console.log(exp);
        clearInterval(timer);
    }
}
// STATE ==========================================================================

var currentRooms = {"test": new Room("a test room\n\nThere is not a lot to see here.\nThis is just a test room.\nIt's meant for testing.\nNothing more.\nGoodbye.",
                          {"north": new Exit("test2"),
                           "east": new Exit("test3"),
                           "south": new Exit("test4", "feather", "you need a feather"),
                           "west": null},
                          {"sword": 1, "bird": 1, "rock": 5, "garbage": 0, "orb": 1, "hidden": 0}),
                          
                    "test2": new Room("another test room\n\nKeep moving along",
                           {"south": new Exit("test")}),
                           
                    "test3": new Room("a loop room\n\nit's probably going to work",
                           {"south": new Exit("test5")}),
  
                    "test4": new Room("locked room\n\nThis room was locked with the bird",
                           {"north": new Exit("test")}),
  
                    "test5": new Room("a loop room, 2\n\nit's probably going to work",
                           {"west": new Exit("test4")})};
                          
var itemCatalogue = {
    "sword": new Item("a rusty sword", "tool", 10),
    "bird": new Item("definitely a bird", "none", 0),
    "dead-bird": new Item("maybe he's pining for the fjords?", "none", 0),
    "feather": new Item("bird-hair", "none", 0),
    "rock": new Item("definitely not a bird", "throwable", 2),
    "garbage": new Item("some junk", "none", 0),
    "shovel": new Item("used to butter bread", "tool", 5)};
    
var recipes = {
    "dead-bird": new Recipe({"bird": 1}, {"sword": 1}, {"dead-bird": 1, "feather": 5})};
    
setIds(currentRooms);
setIds(itemCatalogue);
setIds(recipes);

var everyone = null;
function init(){    
    done = false;
    everyone = {"player": new Body("test", 10),
                "dave": new Body("test", 10),
                "mark": new Body("test", 10),
                "carl": new Body("test", 10)};
    setIds(everyone);
}

var done = false;

function submitCommand(evt){
    if(evt.keyCode == 13){
        var val = input.value.trim().toLowerCase();
        input.value = "";
        everyone["player"].inputQ.push(val);
        return false;
    }
    return true;
}
var input = null;
function setup(){
    input = document.getElementById("input");
    input.addEventListener("keypress", submitCommand, false);
}
</script>
<style type="text/css">
#input, #output{
    position:relative;
    font-family:"Courier New";
    font-size:12pt;
    width:50em;
}
#output{
    height:25em;
    overflow:scroll;
}
</style>
</head>
<body onload="setup()">
    <pre id="output"></pre><br>
    <input type="text" id="input" autocomplete="off"><button onclick="run()" id="start">start</button>

</body>
</html>
